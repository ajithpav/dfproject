from cryptography.hazmat.primitives.serialization import load_pem_public_key
import requests
from requests.exceptions import RequestException
import jwt

token = "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI0WUszV0V2QzVOdXNhSE5BS2Y5OXA1eUk1cmpubjBfUzhLMjJSdjY0Vk9jIn0.eyJleHAiOjE3MDY2NDQ4ODQsImlhdCI6MTcwNjYwODg4OCwiYXV0aF90aW1lIjoxNzA2NjA4ODg0LCJqdGkiOiI0ZjA4YmZlMy01YWMzLTQ5ODEtYWFlMy04MDdhZmVkZGJiNzIiLCJpc3MiOiJodHRwczovL2RldmVsb3BtZW50LnByb2plY3QtcG9sYXJpcy5jb20vYXV0aC9yZWFsbXMvcG9sYXJpcyIsInN1YiI6IjE4NGJlNTIyLWM2NDMtNGZjNS1hOTc2LTIzOGUwOTdmZjUxOSIsInR5cCI6IkJlYXJlciIsImF6cCI6InBvbGFyaXMtcG9ydGFsIiwibm9uY2UiOiI4ZWFkYjliOC1mNzlmLTRmZGYtODkxYS0yZTZkZDVmMmM4NzAiLCJzZXNzaW9uX3N0YXRlIjoiOWY5MjFmYWYtMjI2YS00MDUxLTlmNDctNWRlNTM2NmJiOGQ0IiwiYWxsb3dlZC1vcmlnaW5zIjpbImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMiIsImh0dHBzOi8vZGV2ZWxvcG1lbnQucHJvamVjdC1wb2xhcmlzLmNvbSIsImh0dHA6Ly9sb2NhbC5wcm9qZWN0LXBvbGFyaXMuY29tOjMwMDAvKiIsImh0dHA6Ly9kZXZlbG9wbWVudC12Mi5wcm9qZWN0LXBvbGFyaXMuY29tLnMzLXdlYnNpdGUudXMtZWFzdC0yLmFtYXpvbmF3cy5jb20iLCJodHRwOi8vbG9jYWxob3N0OjMwMDAiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIkJDX1NJVEVfQURNSU5JU1RSQVRPUiJdfSwic2NvcGUiOiJvcGVuaWQgb3JnYW5pemF0aW9ucy1zY29wZSBlbWFpbCBwcm9maWxlIiwic2lkIjoiOWY5MjFmYWYtMjI2YS00MDUxLTlmNDctNWRlNTM2NmJiOGQ0IiwiZW1haWxfdmVyaWZpZWQiOnRydWUsIm5hbWUiOiJCbHVlY29yb25hIEFkbWluIiwib3JnYW5pemF0aW9ucyI6IjYzMDRkNWQ5ZDc5YmY0NjQ4YjA2MWUxMSIsInRlbmFudElEIjoiNjI0ZjBiNjFkMjJhM2Q0NmE0NDhiNGE3IiwicHJlZmVycmVkX3VzZXJuYW1lIjoiYmx1ZWNvcm9uYS5hZG1pbiIsImdpdmVuX25hbWUiOiJCbHVlY29yb25hIiwiZmFtaWx5X25hbWUiOiJBZG1pbiIsImVtYWlsIjoiZGluZXNoQGJsdWVjb3JvbmEuY29tIn0.U_VrjwN-D--33eKjH7ZnztPB_w2fTeIPut4ZRYhvfC5AmvAn3QajWqrEMzCPZAL6ejtDdAsSiyQ3o77fRY4ysJnx9x8V5awWcvK9ilBfRPx8RKoHmW3leFC8h4BMe4wfAvKsLV1p9F_v1f-iny2SahflEgHRTVJ73BV70zIyWiXpAhhPccmtT6O1pCYwoNc5v3sCG0O5ZzWwNJaIRnvhqZ4qzxhdrX9Yi0kBnUnwe9g3XAmYcPSuFKS14faGh3jCFnjviLlVmX2oMUgEUwML-gqD4LiVUSWQyc4SOcAtiDFyfoL-WcmPJeJ0pjOtmuAX-U1Q__SR0jHIiQAh2lh4jwa"
keycloak_url = "https://development.project-polaris.com/auth/realms/polaris/protocol/openid-connect/token"
jwks_url = f"{keycloak_url}/protocol/openid-connect/certs"

try:
    jwks_response = requests.get(jwks_url)
    jwks_data = jwks_response.json()
    public_key = load_pem_public_key(jwks_data['keys'][0]['x5c'][0].encode())
    decoded_token = jwt.decode(token, public_key, algorithms=['RS256'])
except RequestException as e:
    print(f"Error fetching JWKS: {e}")
    exit(1)
except jwt.exceptions.PyJWTError as e:
    print(f"Error decoding token: {e}")
    exit(1)

print(decoded_token)
